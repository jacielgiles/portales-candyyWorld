<!-- Header Compartido -->
<header class="header">
  <div class="logo" onclick="window.location.href='index.html'">
    <img src="img/logo.png" alt="logo">
    <strong>CandyyWorld</strong>
  </div>
  
  <div class="search-bar">
    <div class="field">
      <input type="text" id="searchInput">
      <label for="searchInput">¬øQu√© est√°s buscando?</label>
    </div>
    <div class="search-dropdown" id="searchDropdown">
      <div class="search-category">
        <h4>Categor√≠as</h4>
        <div id="categoryOptions"></div>
      </div>
      <div class="search-category">
        <h4>Sabores</h4>
        <div id="saborOptions"></div>
      </div>
    </div>
  </div>
  
  <nav class="nav">
    <button id="userBtn" class="btn-icon icon-only" aria-label="Usuario">
      <img src="img/person.png" alt="Usuario">
    </button>
    <button id="favoritosBtn" class="btn-icon" style="position:relative">
       Favoritos
    </button>
    <button id="cartBtn" class="btn-icon" style="position:relative">
       üõí Carrito
      <span id="cartBadge" class="cart-badge hidden">0</span>
    </button>
  </nav>
</header>

<!-- Modales Compartidos -->

<!-- LOGIN MODAL -->
<div id="loginModal" class="modal-back">
  <div class="modal">
    <button class="close-btn" id="closeLoginModal">&times;</button>
    <h3>Iniciar sesi√≥n</h3>
    <div id="loginMsg" class="muted"></div>
    <form id="loginForm">
      <div class="field">
        <input id="loginEmail" type="email" required>
        <label for="loginEmail">Correo</label>
      </div>
      <div class="field">
        <input id="loginPassword" type="password" required>
        <label for="loginPassword">Contrase√±a</label>
      </div>
      <div class="field">
        <button class="btn" type="submit">Entrar</button>
      </div>
    </form>
    <div class="switch">¬øNo tienes cuenta? <button id="toRegister">Crear cuenta</button></div>
  </div>
</div>

<!-- REGISTER MODAL -->
<div id="registerModal" class="modal-back">
  <div class="modal">
    <button class="close-btn" id="closeRegisterModal">&times;</button>
    <h3>Crear cuenta</h3>
    <div id="regMsg" class="muted"></div>
    <form id="registerForm">
      <div class="field">
        <input id="regName" type="text" required>
        <label for="regName">Nombre completo</label>
      </div>
      <div class="field">
        <input id="regEmail" type="email" required>
        <label for="regEmail">Correo</label>
      </div>
      <div class="field">
        <input id="regPassword" type="password" required>
        <label for="regPassword">Contrase√±a</label>
      </div>
      <div class="field">
        <input id="regConfirmPassword" type="password" required>
        <label for="regConfirmPassword">Repetir Contrase√±a</label>
      </div>
      <div class="field">
        <input id="regBirth" type="date" required>
        <label for="regBirth">Fecha de nacimiento</label>
      </div>
      <div class="field">
        <button class="btn" type="submit">Crear cuenta</button>
      </div>
    </form>
    <div class="switch">¬øYa tienes cuenta? <button id="toLogin">Iniciar sesi√≥n</button></div>
  </div>
</div>

<!-- PERFIL MODAL -->
<div id="profileModal" class="modal-back profile-modal">
  <div class="modal" style="max-width:600px;max-height:85vh;overflow-y:auto">
    <button class="close-btn" id="closeProfileModal">&times;</button>
    <h3>Mi Perfil</h3>
    
    <!-- Pesta√±as -->
    <div style="display:flex;gap:10px;margin-bottom:20px;border-bottom:2px solid #f0f0f0">
      <button class="profile-tab active" data-tab="info" style="flex:1;padding:12px;border:none;background:transparent;cursor:pointer;font-weight:600;color:#666;border-bottom:3px solid transparent;transition:0.2s">
        Informaci√≥n
      </button>
      <button class="profile-tab" data-tab="pedidos" style="flex:1;padding:12px;border:none;background:transparent;cursor:pointer;font-weight:600;color:#666;border-bottom:3px solid transparent;transition:0.2s">
        Pedidos
      </button>
    </div>
    
    <!-- Tab: Informaci√≥n -->
    <div id="tabInfo" class="profile-tab-content">
      <div class="info">Nombre: <span id="userName"></span></div>
      <div class="info">Correo: <span id="userEmail"></span></div>
      <div class="info">Fecha de nacimiento: <span id="userBirth"></span></div>
      <div class="info highlight">Pedidos completados: <span id="userPedidos"></span></div>
      <div class="info" style="background:#E8F5E9;padding:12px;border-radius:8px;margin-top:12px">
        <span style="color:#2E7D32;font-weight:600;font-size:16px">Puntos: <span id="userPuntos">0</span></span>
        <br>
        <small style="color:#666;margin-top:6px;display:block">Descuento disponible: <span id="userDescuento" style="font-weight:600;color:#FF9EB4;font-size:14px">0%</span></small>
      </div>
    </div>
    
    <!-- Tab: Pedidos -->
    <div id="tabPedidos" class="profile-tab-content" style="display:none">
      <div id="pedidosContainer">
        <div id="pedidosList"></div>
      </div>
    </div>
    
    <!-- Botones siempre visibles -->
    <div style="margin-top:24px;padding-top:20px;border-top:2px solid #f0f0f0">
      <div class="field">
        <button class="btn ghost" id="openChangePass" style="width:100%">Cambiar contrase√±a</button>
      </div>
      <div class="field">
        <button class="btn logout" id="logoutBtn" style="width:100%">Cerrar sesi√≥n</button>
      </div>
    </div>
  </div>
</div>

<!-- CAMBIAR CONTRASE√ëA MODAL -->
<div id="changePassModal" class="modal-back">
  <div class="modal">
    <button class="close-btn" id="closeChangePass">&times;</button>
    <h3>Cambiar contrase√±a</h3>
    <div class="field"><input id="currentPassword" type="password"><label for="currentPassword">Contrase√±a actual</label></div>
    <div class="field"><input id="newPassword" type="password"><label for="newPassword">Nueva contrase√±a</label></div>
    <div class="btn-group">
      <button class="btn" id="updatePass">Actualizar</button>
      <button class="btn cancel" id="cancelPass">Cancelar</button>
    </div>
    <div id="passMsg" class="muted"></div>
  </div>
</div>

<!-- CONFIRMAR CERRAR SESION -->
<div id="logoutConfirmModal" class="modal-back">
  <div class="modal">
    <h3>Confirmar</h3>
    <p>¬øDeseas cerrar sesi√≥n?</p>
    <div style="display:flex;justify-content:center;gap:10px;margin-top:12px">
      <button class="btn logout" id="confirmLogout">Aceptar</button>
      <button class="btn cancel" id="cancelLogout">Cancelar</button>
    </div>
  </div>
</div>

<!-- CARRITO MODAL -->
<div id="cartModal" class="modal-back cart-modal hidden">
  <div class="modal">
    <button class="close-btn" id="closeCartModal">&times;</button>
    <h3>Mi Carrito</h3>
    <div id="cartItems"></div>
    <div id="cartTotal" class="cart-total"></div>
    <button id="checkoutBtn" class="btn" style="width:100%;background:#FF9EB4;margin-top:20px" onclick="finalizarCompra()">
      Finalizar Compra
    </button>
  </div>
</div>

<!-- FAVORITOS MODAL -->
<div id="favoritosModal" class="modal-back cart-modal hidden">
  <div class="modal">
    <button class="close-btn" id="closeFavoritosModal">&times;</button>
    <h3>‚ù§Ô∏è Mis Favoritos</h3>
    <div id="favoritosItems"></div>
  </div>
</div>

<!-- DATOS DE ENV√çO MODAL -->
<div id="envioModal" class="modal-back" style="display:none">
  <div class="modal" style="width:600px;max-height:90vh;overflow-y:auto">
    <button class="close-btn" id="closeEnvioModal">&times;</button>
    <h3>Datos de Entrega y Pago</h3>
    
    <!-- Switches para usar y guardar datos - M√ÅS VISIBLES -->
    <div style="background:linear-gradient(135deg, #E8F5E9 0%, #F1F8E9 100%);padding:20px;border-radius:12px;margin-bottom:24px;display:flex;flex-direction:column;gap:16px;border:3px solid #4CAF50;box-shadow:0 4px 12px rgba(76,175,80,0.2)">
      <!-- Switch: Usar datos guardados -->
      <div style="display:flex;justify-content:space-between;align-items:center;background:white;padding:16px;border-radius:10px;box-shadow:0 2px 8px rgba(0,0,0,0.1)">
        <div>
          <strong style="color:#2E7D32;font-size:17px;font-weight:700">Usar datos guardados</strong>
          <br>
          <small style="color:#666;font-size:13px">Cargar mis datos de env√≠o anteriores</small>
        </div>
        <label class="switch" style="width:70px;height:35px">
          <input type="checkbox" id="usarDatosGuardadosSwitch" onchange="toggleUsarDatosGuardados()">
          <span class="slider"></span>
        </label>
      </div>
      
      <!-- Switch: Guardar datos -->
      <div style="display:flex;justify-content:space-between;align-items:center;background:white;padding:16px;border-radius:10px;box-shadow:0 2px 8px rgba(0,0,0,0.1)">
        <div>
          <strong style="color:#2E7D32;font-size:17px;font-weight:700">Guardar datos</strong>
          <br>
          <small style="color:#666;font-size:13px">Guardar para futuras compras</small>
        </div>
        <label class="switch" style="width:70px;height:35px">
          <input type="checkbox" id="guardarDatosSwitch" onchange="toggleGuardarDatosSwitch()">
          <span class="slider"></span>
        </label>
      </div>
    </div>
    
    <form id="envioForm" onsubmit="event.preventDefault(); procesarCompra();">
      <h4 style="margin:16px 0 8px 0;color:#FF9EB4">Datos de Entrega</h4>
      
      <div class="field">
        <input id="envioNombre" type="text" required>
        <label for="envioNombre">Nombre Completo *</label>
      </div>
      
      <div class="field">
        <input id="envioTelefono" type="tel" required>
        <label for="envioTelefono">Tel√©fono *</label>
      </div>
      
      <div class="field">
        <input id="envioDireccion" type="text" required>
        <label for="envioDireccion">Direcci√≥n *</label>
      </div>
      
      <div style="display:grid;grid-template-columns:1fr 1fr;gap:10px">
        <div class="field">
          <input id="envioCiudad" type="text" required>
          <label for="envioCiudad">Ciudad *</label>
        </div>
        
        <div class="field">
          <input id="envioEstado" type="text" required>
          <label for="envioEstado">Estado *</label>
        </div>
      </div>
      
      <div class="field">
        <input id="envioCP" type="text" required>
        <label for="envioCP">C√≥digo Postal *</label>
      </div>
      
      <div class="field">
        <textarea id="envioReferencias" rows="2"></textarea>
        <label for="envioReferencias">Referencias (opcional)</label>
      </div>
      
      <h4 style="margin:16px 0 8px 0;color:#FF9EB4">M√©todo de Pago</h4>
      
      <div class="field">
        <select id="metodoPago" required onchange="toggleTarjetaFields()">
          <option value="">Selecciona un m√©todo</option>
          <option value="tarjeta">Tarjeta de Cr√©dito/D√©bito</option>
          <option value="efectivo">Efectivo</option>
          <option value="transferencia">Transferencia Bancaria</option>
        </select>
        <label for="metodoPago">M√©todo de Pago *</label>
      </div>
      
      <div id="tarjetaFields" style="display:none">
        <div class="field">
          <input id="nombreTarjeta" type="text">
          <label for="nombreTarjeta">Nombre en la Tarjeta</label>
        </div>
        
        <div class="field">
          <input id="numeroTarjeta" type="text" maxlength="16">
          <label for="numeroTarjeta">N√∫mero de Tarjeta</label>
        </div>
        
        <div style="display:grid;grid-template-columns:1fr 1fr;gap:10px">
          <div class="field">
            <input id="fechaExpiracion" type="text" placeholder="MM/AA">
            <label for="fechaExpiracion">Fecha de Expiraci√≥n</label>
          </div>
          
          <div class="field">
            <input id="cvv" type="text" maxlength="3">
            <label for="cvv">CVV</label>
          </div>
        </div>
      </div>
      
      <button type="submit" class="btn" style="width:100%;margin-top:20px;background:#FF9EB4">
        Confirmar Compra
      </button>
    </form>
  </div>
</div>


<!-- NOTIFICACI√ìN DE COOKIES -->
<div id="cookieNotice" style="display:none;position:fixed;bottom:0;left:0;right:0;background:#fff;border-top:3px solid #FF9EB4;padding:20px;box-shadow:0 -4px 12px rgba(0,0,0,0.15);z-index:10000">
  <div style="max-width:1200px;margin:0 auto;display:flex;justify-content:space-between;align-items:center;gap:20px;flex-wrap:wrap">
    <div style="flex:1;min-width:300px">
      <h4 style="margin:0 0 8px 0;color:#333;font-size:18px">Uso de Cookies</h4>
      <p style="margin:0;color:#666;font-size:14px;line-height:1.5">
        Utilizamos cookies para mejorar tu experiencia de navegaci√≥n, recordar tus preferencias y analizar el tr√°fico del sitio. 
        Al hacer clic en "Aceptar", aceptas el uso de todas las cookies.
      </p>
    </div>
    <div style="display:flex;gap:12px;flex-wrap:wrap">
      <button onclick="acceptCookies()" style="padding:12px 24px;background:#4CAF50;color:white;border:none;border-radius:8px;font-weight:600;cursor:pointer;font-size:14px">
        Aceptar
      </button>
      <button onclick="rejectCookies()" style="padding:12px 24px;background:#f5f5f5;color:#666;border:1px solid #ddd;border-radius:8px;font-weight:600;cursor:pointer;font-size:14px">
        Rechazar
      </button>
    </div>
  </div>
</div>

<script>
// Mostrar notificaci√≥n de cookies si no se ha aceptado
window.addEventListener('DOMContentLoaded', function() {
  const cookieAccepted = localStorage.getItem('cookiesAccepted');
  if (!cookieAccepted) {
    document.getElementById('cookieNotice').style.display = 'block';
  }
});

function acceptCookies() {
  localStorage.setItem('cookiesAccepted', 'true');
  document.getElementById('cookieNotice').style.display = 'none';
}

function rejectCookies() {
  localStorage.setItem('cookiesAccepted', 'false');
  document.getElementById('cookieNotice').style.display = 'none';
}
</script>
