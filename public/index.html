<!DOCTYPE html>
<html lang="es">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width,initial-scale=1">
<title>Inicio - CandyyWorld</title>
<link rel="stylesheet" href="css/style.css">
<style>
/* Estilos espec√≠ficos de la p√°gina de inicio */
.container {
  max-width: 1200px;
  margin: 28px auto;
  padding: 0 16px;
}

.section-title {
  font-size: 28px;
  font-weight: 700;
  margin: 40px 0 24px 0;
  text-align: center;
  color: #333;
  font-family: var(--font-main);
}

.products-slider {
  display: grid;
  grid-template-columns: repeat(5, 1fr);
  gap: 20px;
  margin-bottom: 50px;
  justify-items: center;
}

@media (max-width: 1200px) {
  .products-slider {
    grid-template-columns: repeat(4, 1fr);
  }
}

@media (max-width: 900px) {
  .products-slider {
    grid-template-columns: repeat(3, 1fr);
  }
}

@media (max-width: 650px) {
  .products-slider {
    grid-template-columns: repeat(2, 1fr);
    gap: 16px;
  }
  
  .product-card-mini {
    max-width: 100%;
    padding: 12px;
  }
  
  .product-card-mini img {
    height: 140px;
  }
  
  .product-card-mini h3 {
    font-size: 14px;
    min-height: 36px;
  }
  
  .product-card-mini p {
    font-size: 12px;
  }
  
  .product-card-mini .price {
    font-size: 16px;
  }
}

@media (max-width: 450px) {
  .products-slider {
    grid-template-columns: repeat(2, 1fr);
    gap: 12px;
  }
  
  .product-card-mini {
    padding: 10px;
  }
  
  .product-card-mini img {
    height: 120px;
  }
}

.product-card-mini {
  background: #fff;
  border: 1px solid #e0e0e0;
  border-radius: 12px;
  padding: 16px;
  text-align: center;
  box-shadow: 0 2px 8px rgba(0, 0, 0, 0.06);
  transition: transform 0.2s, box-shadow 0.2s;
  cursor: pointer;
  display: flex;
  flex-direction: column;
  justify-content: space-between;
  width: 100%;
  max-width: 250px;
}

.product-card-mini:hover {
  transform: translateY(-4px);
  box-shadow: 0 6px 16px rgba(0, 0, 0, 0.12);
}

.product-card-mini img {
  width: 100%;
  border-radius: 8px;
  height: 180px;
  object-fit: cover;
  margin-bottom: 12px;
}

.product-card-mini h3 {
  margin: 0 0 8px 0;
  font-size: 16px;
  color: #333;
  font-weight: 600;
  line-height: 1.3;
  min-height: 40px;
  display: -webkit-box;
  -webkit-line-clamp: 2;
  line-clamp: 2;
  -webkit-box-orient: vertical;
  overflow: hidden;
}

.product-card-mini p {
  margin: 0 0 8px 0;
  font-size: 13px;
  color: #666;
  line-height: 1.4;
  flex: 1;
}

.product-card-mini .price {
  font-weight: 700;
  color: var(--primary);
  margin-top: auto;
  font-size: 18px;
  padding-top: 8px;
  border-top: 1px solid #f0f0f0;
}

.promo-grid {
  display: grid;
  grid-template-columns: repeat(2, 1fr);
  gap: 16px;
  margin-bottom: 40px;
  max-width: 800px;
  margin-left: auto;
  margin-right: auto;
}

.promo-card {
  background: #fff;
  border-radius: 12px;
  overflow: hidden;
  box-shadow: 0 2px 8px rgba(0, 0, 0, 0.08);
  transition: transform 0.2s, box-shadow 0.2s;
  cursor: pointer;
  aspect-ratio: 2/1;
  position: relative;
  max-height: 180px;
}

.promo-card:hover {
  transform: translateY(-4px);
  box-shadow: 0 6px 16px rgba(0, 0, 0, 0.12);
}

.promo-card img {
  width: 100%;
  height: 100%;
  object-fit: cover;
  display: block;
}

.banner-carousel {
  position: relative;
  width: 100%;
  height: 500px;
  margin: 0;
  overflow: hidden;
  box-shadow: 0 6px 18px rgba(13, 47, 80, 0.08);
}

.banner-slides {
  display: flex;
  transition: transform 0.5s ease-in-out;
  height: 100%;
}

.banner-slide {
  min-width: 100%;
  height: 100%;
  display: flex;
  align-items: center;
  justify-content: center;
}

.banner-slide img {
  width: 100%;
  height: 100%;
  object-fit: cover;
}

.banner-arrow {
  position: absolute;
  top: 50%;
  transform: translateY(-50%);
  background: rgba(255, 255, 255, 0.9);
  border: none;
  width: 40px;
  height: 40px;
  border-radius: 50%;
  cursor: pointer;
  font-size: 20px;
  font-weight: bold;
  color: #333;
  transition: 0.2s;
  z-index: 10;
}

.banner-arrow:hover {
  background: rgba(255, 255, 255, 1);
  transform: translateY(-50%) scale(1.1);
}

.banner-arrow.left {
  left: 10px;
}

.banner-arrow.right {
  right: 10px;
}

.banner-dots {
  position: absolute;
  bottom: 15px;
  left: 50%;
  transform: translateX(-50%);
  display: flex;
  gap: 8px;
  z-index: 10;
}

.banner-dot {
  width: 10px;
  height: 10px;
  border-radius: 50%;
  background: rgba(255, 255, 255, 0.5);
  border: none;
  cursor: pointer;
  transition: 0.3s;
}

.banner-dot.active {
  background: rgba(255, 255, 255, 1);
  width: 24px;
  border-radius: 5px;
}

/* Responsive */
@media (max-width: 768px) {
  .promo-grid {
    grid-template-columns: 1fr;
    max-width: 100%;
  }
  
  .promo-card {
    max-height: 200px;
  }
  
  .products-slider {
    grid-template-columns: repeat(2, 1fr);
    gap: 16px;
  }
  
  .banner-carousel {
    height: 250px;
  }
  
  .product-card-mini h3 {
    font-size: 14px;
  }
  
  .product-card-mini p {
    font-size: 11px;
  }
  
  .container {
    padding: 0 12px;
  }
}

@media (max-width: 500px) {
  .products-slider {
    grid-template-columns: 1fr;
  }
  
  .promo-grid {
    grid-template-columns: 1fr;
  }
  
  .section-title {
    font-size: 22px;
    margin: 20px 0 16px 0;
  }
  
  .banner-carousel {
    height: 250px;
  }
}
</style>
</head>
<body>

<header class="header">
  <div class="logo"><img src="img/logo.png" alt="logo"></div>
  
  <div class="search-bar">
    <div class="field">
      <input type="text" id="searchInput">
      <label for="searchInput">¬øQu√© est√°s buscando?</label>
    </div>
    <div class="search-dropdown" id="searchDropdown">
      <div class="search-category">
        <h4>Categor√≠as</h4>
        <div id="categoryOptions"></div>
      </div>
      <div class="search-category">
        <h4>Sabores</h4>
        <div id="saborOptions"></div>
      </div>
    </div>
  </div>
  
  <nav class="nav">
    <button id="userBtn" class="btn-icon icon-only" aria-label="Usuario">
      <img src="img/person.png" alt="Usuario">
    </button>
    <button id="favoritosBtn" class="btn-icon" style="position:relative">
       ‚ù§Ô∏è Favoritos
    </button>
    <button id="cartBtn" class="btn-icon" style="position:relative">
       üõí Carrito
      <span id="cartBadge" class="cart-badge hidden">0</span>
    </button>
  </nav>
</header>

<!-- BANNER CAROUSEL -->
<div class="banner-carousel">
  <div class="banner-slides" id="bannerSlides">
    <div class="banner-slide"><img src="img/banner1.jpg" alt="Banner 1"></div>
    <div class="banner-slide"><img src="img/banner2.jpeg" alt="Banner 2"></div>
    <div class="banner-slide"><img src="img/banner3.jpeg" alt="Banner 3"></div>
  </div>
  <button class="banner-arrow left" id="prevBtn">‚Äπ</button>
  <button class="banner-arrow right" id="nextBtn">‚Ä∫</button>
  <div class="banner-dots" id="bannerDots"></div>
</div>

<!-- Deslizador de Pa√≠ses -->
<section class="slider-section" style="margin-top:60px;margin-bottom:120px">
  <div style="max-width:100%;margin:0 auto;padding:0">
    <h2 style="text-align:center;color:#FF9EB4;margin-bottom:60px;font-size:32px;font-weight:700">Explora por Pa√≠s</h2>
    <div class="slider-container">
      <div class="slider slider-left" id="paisesSlider">
        <!-- Se llena con JavaScript -->
      </div>
    </div>
  </div>
</section>

<main class="container" style="margin-top:0;margin-bottom:120px">
  <!-- PRODUCTOS RECOMENDADOS -->
  <div style="display:flex;justify-content:space-between;align-items:center;margin-bottom:32px">
    <h2 class="section-title" style="margin:0">Recomendado</h2>
    <a href="productos.html" style="color:#FF9EB4;font-weight:600;text-decoration:none;font-size:16px;transition:0.2s;font-family:var(--font-main)" onmouseover="this.style.color='#FF8AA8'" onmouseout="this.style.color='#FF9EB4'">
      Ver todo ‚Üí
    </a>
  </div>
  <div id="featuredProducts" class="products-slider"></div>
</main>

<!-- Deslizador de Marcas -->
<section class="slider-section" style="margin-top:0;margin-bottom:120px">
  <div style="max-width:100%;margin:0 auto;padding:0">
    <h2 style="text-align:center;color:#FF9EB4;margin-bottom:60px;font-size:32px;font-weight:700">Explora por Marca</h2>
    <div class="slider-container">
      <div class="slider slider-right" id="marcasSlider">
        <!-- Se llena con JavaScript -->
      </div>
    </div>
  </div>
</section>

<main class="container" style="margin-top:0;margin-bottom:120px">
  <!-- PROMOCIONES -->
  <h2 class="section-title" style="margin-bottom:32px">Promociones</h2>
  <div class="promo-grid">
    <div class="promo-card" onclick="window.location.href='productos.html'">
      <img src="img/promo1.jpg" alt="Promo 1" onerror="this.src='img/banner1.jpg'">
    </div>
    <div class="promo-card" onclick="window.location.href='productos.html'">
      <img src="img/promo2.jpeg" alt="Promo 2" onerror="this.src='img/banner2.jpeg'">
    </div>
  </div>
</main>

<!-- LOGIN MODAL -->
<div id="loginModal" class="modal-back">
  <div class="modal" style="max-width:400px;padding:32px">
    <button class="close-btn" id="closeLoginModal">&times;</button>
    <h3 style="text-align:center;margin-bottom:24px;font-size:24px">Iniciar sesi√≥n</h3>
    <div id="loginMsg" class="muted" style="text-align:center"></div>
    <form id="loginForm">
      <div class="field"><input id="loginEmail" type="email" required><label for="loginEmail">Correo</label></div>
      <div class="field"><input id="loginPassword" type="password" required><label for="loginPassword">Contrase√±a</label></div>
      <div class="field" style="margin-bottom:12px"><button class="btn" type="submit" style="width:100%">Entrar</button></div>
      <div class="field" style="text-align:center;margin-top:0">
        <p style="margin:0;font-size:14px;color:#666">¬øNo tienes cuenta? <button type="button" id="toRegister" style="background:none;border:none;color:#FF9EB4;font-weight:600;cursor:pointer;font-size:14px;padding:0;text-decoration:underline">Crear cuenta</button></p>
      </div>
    </form>
  </div>
</div>

<!-- REGISTER MODAL -->
<div id="registerModal" class="modal-back">
  <div class="modal" style="max-width:450px;padding:32px">
    <button class="close-btn" id="closeRegisterModal">&times;</button>
    <h3 style="text-align:center;margin-bottom:24px;font-size:24px">Crear cuenta</h3>
    <div id="regMsg" class="muted" style="text-align:center"></div>
    <form id="registerForm">
      <div class="field"><input id="regName" type="text" required><label for="regName">Nombre completo</label></div>
      <div class="field"><input id="regEmail" type="email" required><label for="regEmail">Correo</label></div>
      <div class="field"><input id="regPassword" type="password" required><label for="regPassword">Contrase√±a</label></div>
      <div class="field"><input id="regConfirmPassword" type="password" required><label for="regConfirmPassword">Repetir Contrase√±a</label></div>
      <div class="field"><input id="regBirth" type="date" required><label for="regBirth">Fecha de nacimiento</label></div>
      <div class="field"><button class="btn" type="submit" style="width:100%">Crear cuenta</button></div>
    </form>
    <div class="switch" style="text-align:center;margin-top:20px;font-size:14px">¬øYa tienes cuenta? <button id="toLogin" style="font-size:14px">Iniciar sesi√≥n</button></div>
  </div>
</div>

<!-- PERFIL MODAL -->
<div id="profileModal" class="modal-back profile-modal">
  <div class="modal" style="max-width:600px;max-height:85vh;overflow-y:auto">
    <button class="close-btn" id="closeProfileModal">&times;</button>
    <h3>Mi Perfil</h3>
    
    <!-- Pesta√±as -->
    <div style="display:flex;gap:10px;margin-bottom:20px;border-bottom:2px solid #f0f0f0">
      <button class="profile-tab active" data-tab="info" style="flex:1;padding:12px;border:none;background:transparent;cursor:pointer;font-weight:600;color:#666;border-bottom:3px solid transparent;transition:0.2s">
        üë§ Informaci√≥n
      </button>
      <button class="profile-tab" data-tab="pedidos" style="flex:1;padding:12px;border:none;background:transparent;cursor:pointer;font-weight:600;color:#666;border-bottom:3px solid transparent;transition:0.2s">
        üì¶ Pedidos
      </button>
    </div>
    
    <!-- Tab: Informaci√≥n -->
    <div id="tabInfo" class="profile-tab-content">
      <div class="info">Nombre: <span id="userName"></span></div>
      <div class="info">Correo: <span id="userEmail"></span></div>
      <div class="info">Fecha de nacimiento: <span id="userBirth"></span></div>
      <div class="info highlight">Pedidos completados: <span id="userPedidos"></span></div>
      <div class="info" style="background:#E8F5E9;padding:12px;border-radius:8px;margin-top:12px">
        <span style="color:#2E7D32;font-weight:600;font-size:16px">‚≠ê Puntos: <span id="userPuntos">0</span></span>
        <br>
        <small style="color:#666;margin-top:6px;display:block">Descuento disponible: <span id="userDescuento" style="font-weight:600;color:#FF9EB4;font-size:14px">0%</span></small>
      </div>
    </div>
    
    <!-- Tab: Pedidos -->
    <div id="tabPedidos" class="profile-tab-content" style="display:none">
      <div id="pedidosContainer">
        <div id="pedidosList"></div>
      </div>
    </div>
    
    <!-- Botones siempre visibles -->
    <div style="margin-top:24px;padding-top:20px;border-top:2px solid #f0f0f0">
      <div class="field">
        <button class="btn ghost" id="openChangePass" style="width:100%">üîí Cambiar contrase√±a</button>
      </div>
      <div class="field">
        <button class="btn logout" id="logoutBtn" style="width:100%">üö™ Cerrar sesi√≥n</button>
      </div>
    </div>
  </div>
</div>

<!-- CAMBIAR CONTRASE√ëA MODAL -->
<div id="changePassModal" class="modal-back">
  <div class="modal">
    <button class="close-btn" id="closeChangePass">&times;</button>
    <h3>Cambiar contrase√±a</h3>
    <div class="field"><input id="currentPassword" type="password"><label for="currentPassword">Contrase√±a actual</label></div>
    <div class="field"><input id="newPassword" type="password"><label for="newPassword">Nueva contrase√±a</label></div>
    <div class="btn-group">
      <button class="btn" id="updatePass">Actualizar</button>
      <button class="btn cancel" id="cancelPass">Cancelar</button>
    </div>
    <div id="passMsg" class="muted"></div>
  </div>
</div>

<!-- CONFIRMAR CERRAR SESION -->
<div id="logoutConfirmModal" class="modal-back">
  <div class="modal">
    <h3>Confirmar</h3>
    <p>¬øDeseas cerrar sesi√≥n?</p>
    <div style="display:flex;justify-content:center;gap:10px;margin-top:12px">
      <button class="btn logout" id="confirmLogout">Aceptar</button>
      <button class="btn cancel" id="cancelLogout">Cancelar</button>
    </div>
  </div>
</div>


<!-- CARRITO MODAL -->
<div id="cartModal" class="modal-back cart-modal hidden">
  <div class="modal">
    <button class="close-btn" id="closeCartModal">&times;</button>
    <h3>Mi Carrito</h3>

    <div id="cartItems"></div>

    <div id="cartTotal" class="cart-total"></div>

    <button id="checkoutBtn" class="btn" style="width:100%;background:#FF9EB4;margin-top:20px" onclick="finalizarCompra()">
      Finalizar Compra
    </button>
  </div>
</div>

<!-- FAVORITOS MODAL -->
<div id="favoritosModal" class="modal-back cart-modal hidden">
  <div class="modal">
    <button class="close-btn" id="closeFavoritosModal">&times;</button>
    <h3>‚ù§Ô∏è Mis Favoritos</h3>

    <div id="favoritosItems"></div>
  </div>
</div>

<!-- DATOS DE ENV√çO MODAL -->
<div id="envioModal" class="modal-back" style="display:none">
  <div class="modal" style="width:650px;max-height:92vh;overflow-y:auto;padding:28px">
    <button class="close-btn" id="closeEnvioModal">&times;</button>
    <h3 style="margin-bottom:24px;font-size:24px;color:#FF9EB4;text-align:center">üì¶ Datos de Entrega y Pago</h3>
    
    <form id="envioForm" onsubmit="event.preventDefault(); procesarCompra();">
      <!-- Bot√≥n para cargar datos guardados -->
      <div id="botonDatosGuardados" style="display:none;margin-bottom:20px">
        <button type="button" class="btn" style="width:100%;background:#4CAF50;display:flex;align-items:center;justify-content:center;gap:8px" onclick="cargarDatosGuardadosManual()">
          <span>üíæ</span>
          <span>Usar informaci√≥n guardada</span>
        </button>
      </div>
      
      <!-- Mensaje de datos cargados -->
      <div id="mensajeDatosGuardados" style="display:none;background:#E8F5E9;padding:12px;border-radius:8px;margin-bottom:16px;border-left:4px solid #4CAF50">
        <strong style="color:#2E7D32">‚úì Datos guardados cargados</strong>
        <p style="margin:4px 0 0 0;font-size:13px;color:#666">Puedes modificarlos si lo deseas.</p>
      </div>
      
      <h4 style="margin:16px 0 12px 0;color:#FF9EB4;font-size:18px;font-weight:700">üì¶ Datos de Entrega</h4>
      
      <div class="field">
        <input id="envioNombre" type="text" required autocomplete="name">
        <label for="envioNombre">Nombre Completo *</label>
      </div>
      
      <div class="field">
        <input id="envioTelefono" type="tel" required autocomplete="tel">
        <label for="envioTelefono">Tel√©fono *</label>
      </div>
      
      <div class="field">
        <input id="envioDireccion" type="text" required autocomplete="street-address">
        <label for="envioDireccion">Direcci√≥n *</label>
      </div>
      
      <div style="display:grid;grid-template-columns:1fr 1fr;gap:12px">
        <div class="field">
          <input id="envioCiudad" type="text" required autocomplete="address-level2">
          <label for="envioCiudad">Ciudad *</label>
        </div>
        
        <div class="field">
          <input id="envioEstado" type="text" required autocomplete="address-level1">
          <label for="envioEstado">Estado *</label>
        </div>
      </div>
      
      <div class="field">
        <input id="envioCP" type="text" required autocomplete="postal-code">
        <label for="envioCP">C√≥digo Postal *</label>
      </div>
      
      <div class="field">
        <textarea id="envioReferencias" rows="2"></textarea>
        <label for="envioReferencias">Referencias (opcional)</label>
      </div>
      
      <!-- Checkbox para guardar datos -->
      <div style="margin:16px 0">
        <label style="display:flex;align-items:center;gap:8px;cursor:pointer;font-size:14px;font-family:var(--font-main)">
          <input type="checkbox" id="guardarDatosEnvio" style="width:18px;height:18px;cursor:pointer">
          <span>üíæ Guardar estos datos para futuras compras</span>
        </label>
      </div>
      
      <h4 style="margin:24px 0 12px 0;color:#FF9EB4;font-size:18px;font-weight:700">üí≥ M√©todo de Pago</h4>
      
      <div class="field">
        <select id="metodoPago" required onchange="toggleTarjetaFields()">
          <option value="">Selecciona un m√©todo</option>
          <option value="tarjeta">üí≥ Tarjeta de Cr√©dito/D√©bito</option>
          <option value="efectivo">üíµ Efectivo</option>
          <option value="transferencia">üè¶ Transferencia Bancaria</option>
        </select>
        <label for="metodoPago">M√©todo de Pago *</label>
      </div>
      
      <div id="tarjetaFields" style="display:none;margin-top:16px;padding:16px;background:#f9f9f9;border-radius:8px">
        <p style="margin:0 0 12px 0;font-size:13px;color:#666;font-family:var(--font-main)">
          <strong>Nota:</strong> Los datos de tarjeta no se guardan por seguridad.
        </p>
        
        <div class="field">
          <input id="nombreTarjeta" type="text" autocomplete="cc-name">
          <label for="nombreTarjeta">Nombre en la Tarjeta</label>
        </div>
        
        <div class="field">
          <input id="numeroTarjeta" type="text" maxlength="19" autocomplete="cc-number" placeholder="1234 5678 9012 3456">
          <label for="numeroTarjeta">N√∫mero de Tarjeta</label>
        </div>
        
        <div style="display:grid;grid-template-columns:1fr 1fr;gap:12px">
          <div class="field">
            <input id="fechaExpiracion" type="text" placeholder="MM/AA" maxlength="5" autocomplete="cc-exp">
            <label for="fechaExpiracion">Expiraci√≥n</label>
          </div>
          
          <div class="field">
            <input id="cvv" type="text" maxlength="4" autocomplete="cc-csc" placeholder="123">
            <label for="cvv">CVV</label>
          </div>
        </div>
      </div>
      
      <button type="submit" class="btn" style="width:100%;margin-top:24px;background:#FF9EB4;padding:14px;font-size:16px;font-weight:700">
        ‚úì Confirmar Compra
      </button>
    </form>
  </div>
</div>

<script src="cart.js"></script>
<script>


const $ = id=>document.getElementById(id);
// Modales
const loginModal = $('loginModal');
const registerModal = $('registerModal');
const profileModal = $('profileModal');
const changePassModal = $('changePassModal');
const logoutConfirmModal = $('logoutConfirmModal');
const cartModal = $('cartModal');

// Botones
const userBtn = $('userBtn');
const cartBtn = $('cartBtn');
const closeCartModal = $('closeCartModal');
const cartBadge = $('cartBadge');
const cartItems = $('cartItems');
const cartTotal = $('cartTotal');
const openChangePass = $('openChangePass');
const closeChangePass = $('closeChangePass');
const closeProfileModal = $('closeProfileModal');
const cancelPass = $('cancelPass');
const logoutBtn = $('logoutBtn');
const confirmLogout = $('confirmLogout');
const cancelLogout = $('cancelLogout');

// Formularios y mensajes
const loginForm = $('loginForm');
const registerForm = $('registerForm');
const loginMsg = $('loginMsg');
const regMsg = $('regMsg');
const passMsg = $('passMsg');
const logoutMsg = $('logoutMsg');

// Datos de usuario
const welcomeText = $('welcomeText');
const userName = $('userName');
const email = $('userEmail');
const userPedidos = $('userPedidos');
const userBirth = $('userBirth');
const currentPassword = $('currentPassword');
const newPassword = $('newPassword');
const updatePass = $('updatePass');

function show(el){el.style.display='flex'}
function hide(el){el.style.display='none'}

function setUserUI(user){
  const profileModalContent = profileModal.querySelector('.modal');
  if(!user){
    if (welcomeText) welcomeText.textContent = 'Bienvenido, por favor inicia sesi√≥n';
    // Cuando no hay usuario, ocultamos modales de perfil relacionados
    hide(profileModal); hide(changePassModal); hide(logoutConfirmModal);
  } else {
    if (welcomeText) welcomeText.textContent = `Bienvenido ${user.name}`;
    // Ocultar modales de autenticaci√≥n cuando ya hay usuario
    hide(loginModal); hide(registerModal);
    updateCartBadge();
    if(userName) userName.textContent = user.name;
    if(userEmail) userEmail.textContent = user.email;
    if(userBirth) userBirth.textContent = (user.birthdate || '').split('T')[0] || '';
    if(userPedidos) userPedidos.textContent = user.pedidos || '0';
    
    // Mostrar puntos en el perfil
    const userPuntos = $('userPuntos');
    if (userPuntos) {
      userPuntos.textContent = user.puntos || '0';
      // Nuevo sistema: 1 punto = 0.5% descuento, m√°ximo 45%
      const descuento = Math.floor((user.puntos || 0) * 0.5);
      const descuentoMax = descuento > 45 ? 45 : descuento;
      const userDescuento = $('userDescuento');
      if (userDescuento) {
        userDescuento.textContent = descuentoMax + '%';
      }
    }

    // --- ADMIN: agregar bot√≥n de "Panel de Administrador" ---
    let adminBtn = null;
    if (profileModalContent) adminBtn = profileModalContent.querySelector('#addProductBtn');
    if(user.email === 'langosta@admin.com') {
      if(!adminBtn && profileModalContent){
        adminBtn = document.createElement('button');
        adminBtn.id = 'addProductBtn';
        adminBtn.className = 'btn';
        adminBtn.textContent = 'üõ†Ô∏è Panel de Administrador';
        adminBtn.style.marginTop = '10px';
        adminBtn.addEventListener('click', ()=>{
          window.location.href = 'admin.html';
        });
        profileModalContent.appendChild(adminBtn);
      }
    } else {
      if(adminBtn) adminBtn.remove();
    }
  }
}


// Cargar usuario guardado
let currentUser = localStorage.getItem('user') ? JSON.parse(localStorage.getItem('user')) : null;
setUserUI(currentUser);

// Navegaci√≥n y modales
$('toRegister').addEventListener('click',()=>{hide(loginModal); show(registerModal)});
$('toLogin').addEventListener('click',()=>{hide(registerModal); show(loginModal)});
// Cuando se hace click en el bot√≥n de usuario: si no hay sesi√≥n, abrir login; si hay sesi√≥n, abrir perfil
userBtn.addEventListener('click', async ()=>{
  if(!currentUser) {
    show(loginModal);
  } else {
    show(profileModal);
    // Activar tab de informaci√≥n por defecto
    switchProfileTab('info');
    // Cargar pedidos si la funci√≥n existe
    if (typeof mostrarPedidosEnPerfil === 'function') {
      await mostrarPedidosEnPerfil();
    }
  }
});

// Funci√≥n para cambiar entre tabs del perfil
function switchProfileTab(tabName) {
  // Actualizar botones
  document.querySelectorAll('.profile-tab').forEach(btn => {
    btn.classList.remove('active');
    btn.style.color = '#666';
    btn.style.borderBottom = '3px solid transparent';
  });
  
  const activeBtn = document.querySelector(`.profile-tab[data-tab="${tabName}"]`);
  if (activeBtn) {
    activeBtn.classList.add('active');
    activeBtn.style.color = '#FF9EB4';
    activeBtn.style.borderBottom = '3px solid #FF9EB4';
  }
  
  // Actualizar contenido
  document.querySelectorAll('.profile-tab-content').forEach(content => {
    content.style.display = 'none';
  });
  
  const activeContent = document.getElementById(`tab${tabName.charAt(0).toUpperCase() + tabName.slice(1)}`);
  if (activeContent) {
    activeContent.style.display = 'block';
  }
}

// Event listeners para las tabs
document.addEventListener('click', (e) => {
  if (e.target.classList.contains('profile-tab')) {
    const tabName = e.target.getAttribute('data-tab');
    switchProfileTab(tabName);
  }
});
$('closeLoginModal').addEventListener('click',()=>hide(loginModal));
$('closeRegisterModal').addEventListener('click',()=>hide(registerModal));
// El cierre del modal de perfil mantiene el mismo id
closeProfileModal.addEventListener('click',()=>hide(profileModal));
openChangePass.addEventListener('click',()=>{show(changePassModal); hide(profileModal)});
closeChangePass.addEventListener('click',()=>hide(changePassModal));
cancelPass.addEventListener('click',()=>hide(changePassModal));

// Carrito
cartBtn.addEventListener('click',()=>{
  if(!currentUser){
    show(loginModal);
    return;
  }
  loadCart();
  show(cartModal);
});
closeCartModal.addEventListener('click',()=>hide(cartModal));

// Favoritos
const favoritosBtn = $('favoritosBtn');
const favoritosModal = $('favoritosModal');
const closeFavoritosModal = $('closeFavoritosModal');

favoritosBtn.addEventListener('click',()=>{
  if(!currentUser){
    show(loginModal);
    return;
  }
  loadFavoritos();
  show(favoritosModal);
});
closeFavoritosModal.addEventListener('click',()=>hide(favoritosModal));

// Modal de env√≠o
const envioModal = $('envioModal');
const closeEnvioModal = $('closeEnvioModal');
closeEnvioModal.addEventListener('click',()=>{
  envioModal.style.display='none';
  show(cartModal);
});

function updateCartBadge(){
  if(!currentUser || !currentUser.carrito) {
    cartBadge.classList.add('hidden');
    return;
  }
  let cart = [];
  try{ cart = JSON.parse(currentUser.carrito || "[]"); }catch{}
  if(cart.length > 0){
    cartBadge.textContent = cart.length;
    cartBadge.classList.remove('hidden');
  } else {
    cartBadge.classList.add('hidden');
  }
}

// LOGIN
loginForm.addEventListener('submit', async e => {
  e.preventDefault();
  loginMsg.textContent = '';
  const email = $('loginEmail').value.trim();
  const password = $('loginPassword').value.trim();
  if (!email || !password) {
    loginMsg.textContent = 'Completa email y contrase√±a';
    return;
  }
  try {
    // Verificar si es el admin
    if(email === 'langosta@admin' && password === 'portales') {
      localStorage.setItem('admin', 'true');
      window.location.href = 'index.html';
      return;
    }

    const res = await fetch('/.netlify/functions/login', {
      method: 'POST',
      headers: { 'Content-Type': 'application/json' },
      body: JSON.stringify({ email, password })
    });
    const data = await res.json();
    if (!data.success) {
      loginMsg.textContent = data.message || 'Error al iniciar sesi√≥n';
      return;
    }
    localStorage.setItem('user', JSON.stringify(data.user));
    currentUser = data.user;
    setUserUI(currentUser);
    hide(loginModal);
    showNotification(`¬°Bienvenido ${data.user.name}! üéâ`, 'success');
  } catch (err) {
    loginMsg.textContent = 'Error de conexi√≥n';
  }
});


// REGISTER
registerForm.addEventListener('submit', async e=>{
  e.preventDefault();
  regMsg.textContent='';
  const name=$('regName').value.trim();
  const email=$('regEmail').value.trim();
  const password=$('regPassword').value.trim();
  const confirmPass=$('regConfirmPassword').value.trim();
  const birthdate=$('regBirth').value;
  if(!name||!email||!password||!confirmPass||!birthdate){regMsg.textContent='Completa todos los campos';return;}
  if(password!==confirmPass){regMsg.textContent='Las contrase√±as no coinciden';return;}
  try{
    const res = await fetch('/.netlify/functions/register',{
      method:'POST',
      headers:{'Content-Type':'application/json'},
      body:JSON.stringify({name,email,password,birthdate})
    });
    const data = await res.json();
    if(!data.success){regMsg.textContent=data.message||'Error al crear cuenta';return;}
    localStorage.setItem('user',JSON.stringify(data.user));
    currentUser = data.user;
    setUserUI(currentUser);
    hide(registerModal);
    showNotification(`¬°Cuenta creada exitosamente! Bienvenido ${data.user.name} üéâ`, 'success');
  }catch(err){regMsg.textContent='Error de conexi√≥n'}
});

// CERRAR SESI√ìN
logoutBtn.addEventListener('click',()=> show(logoutConfirmModal));
cancelLogout.addEventListener('click',()=> hide(logoutConfirmModal));
confirmLogout.addEventListener('click',()=>{
  const userName = currentUser ? currentUser.name : 'Usuario';
  localStorage.removeItem('user');
  currentUser = null;
  setUserUI(currentUser);
  hide(logoutConfirmModal);
  showNotification(`¬°Hasta pronto ${userName}! üëã`, 'success');
});

// CAMBIAR CONTRASE√ëA
updatePass.addEventListener('click', async ()=>{
  passMsg.textContent='';
  const current = currentPassword.value.trim();
  const newP = newPassword.value.trim();
  if(!current||!newP){passMsg.textContent='Completa ambos campos';return;}
  try{
    const res = await fetch('/.netlify/functions/updatePassword',{
      method:'POST',
      headers:{'Content-Type':'application/json'},
      body:JSON.stringify({email:currentUser.email,currentPassword:current,newPassword:newP})
    });
    const data = await res.json();
    passMsg.textContent = data.message;
    if(data.success){
      currentPassword.value=''; newPassword.value='';
      hide(changePassModal);
    }
  }catch(err){passMsg.textContent='Error de conexi√≥n'}
});

// BANNER CAROUSEL
const bannerSlides = $('bannerSlides');
const prevBtn = $('prevBtn');
const nextBtn = $('nextBtn');
const bannerDots = $('bannerDots');
let currentSlide = 0;
const totalSlides = bannerSlides.children.length;

// Crear dots
for(let i=0; i<totalSlides; i++){
  const dot = document.createElement('button');
  dot.className = 'banner-dot';
  if(i===0) dot.classList.add('active');
  dot.addEventListener('click', ()=> goToSlide(i));
  bannerDots.appendChild(dot);
}

function goToSlide(n){
  currentSlide = n;
  if(currentSlide < 0) currentSlide = totalSlides - 1;
  if(currentSlide >= totalSlides) currentSlide = 0;
  bannerSlides.style.transform = `translateX(-${currentSlide * 100}%)`;
  document.querySelectorAll('.banner-dot').forEach((dot, i)=>{
    dot.classList.toggle('active', i === currentSlide);
  });
}

prevBtn.addEventListener('click', ()=> goToSlide(currentSlide - 1));
nextBtn.addEventListener('click', ()=> goToSlide(currentSlide + 1));

// Auto-play cada 5 segundos
setInterval(()=> goToSlide(currentSlide + 1), 5000);

// BUSCADOR CON FILTROS
const searchInput = $('searchInput');
const searchDropdown = $('searchDropdown');
const categoryOptions = $('categoryOptions');
const saborOptions = $('saborOptions');

// Cargar categor√≠as y sabores desde la DB
async function loadSearchFilters(){
  try{
    const res = await fetch('/.netlify/functions/getProductos', { method:'POST' });
    const data = await res.json();
    if(!data.success) return;
    
    const productos = data.products;
    const categorias = [...new Set(productos.map(p=>p.categoria))];
    const sabores = [...new Set(productos.map(p=>p.sabor))];
    
    categoryOptions.innerHTML = categorias.map(cat=>
      `<div class="search-option" onclick="searchBy('categoria','${cat}')">${cat}</div>`
    ).join('');
    
    saborOptions.innerHTML = sabores.map(sab=>
      `<div class="search-option" onclick="searchBy('sabor','${sab}')">${sab}</div>`
    ).join('');
  }catch(err){console.error(err);}
}

searchInput.addEventListener('focus', ()=>{
  searchDropdown.classList.add('active');
  if(categoryOptions.innerHTML === '') loadSearchFilters();
});

searchInput.addEventListener('blur', ()=>{
  setTimeout(()=>searchDropdown.classList.remove('active'), 200);
});

searchInput.addEventListener('keypress', (e)=>{
  if(e.key === 'Enter'){
    const query = searchInput.value.trim();
    if(query) window.location.href = `productos.html?search=${encodeURIComponent(query)}`;
  }
});

function searchBy(tipo, valor){
  window.location.href = `productos.html?${tipo}=${encodeURIComponent(valor)}`;
}

loadSearchFilters();

// CARGAR PRODUCTOS RECOMENDADOS (cambian cada d√≠a de la semana)
async function loadFeaturedProducts(){
  try{
    const res = await fetch('/.netlify/functions/getProductos', { method:'POST' });
    const data = await res.json();
    if(!data.success) return;
    
    const allProducts = data.products;
    
    // Obtener el d√≠a de la semana (0 = Domingo, 1 = Lunes, ..., 6 = S√°bado)
    const today = new Date().getDay();
    
    // Mezclar productos basado en el d√≠a de la semana
    const shuffledProducts = shuffleArrayByDay(allProducts, today);
    
    // Mostrar 5 productos
    const productos = shuffledProducts.slice(0, 5);
    const featuredContainer = $('featuredProducts');
    
    featuredContainer.innerHTML = productos.map(prod=>`
      <div class="product-card-mini" onclick="window.location.href='espec_producto.html?id=${prod.id}'">
        <img src="${prod.imagen}" alt="${prod.nombre}" onerror="this.src='img/banner1.jpg'">
        <h3>${prod.nombre}</h3>
        ${prod.marca ? `<p style="font-size:12px;color:#FF9EB4;font-weight:600;margin:0 0 4px 0">üè∑Ô∏è ${prod.marca}</p>` : ''}
        <p>${prod.descripcion.substring(0, 40)}...</p>
        <p class="price">$${parseFloat(prod.precio).toFixed(2)}</p>
      </div>
    `).join('');
  }catch(err){console.error(err);}
}

// Funci√≥n para mezclar array basado en el d√≠a (seed determin√≠stico)
function shuffleArrayByDay(array, day) {
  const shuffled = [...array];
  
  // Usar el d√≠a como semilla para un orden consistente cada d√≠a
  for (let i = shuffled.length - 1; i > 0; i--) {
    // Generar √≠ndice pseudo-aleatorio basado en el d√≠a y la posici√≥n
    const j = Math.floor(((day * 1000 + i * 7) % shuffled.length));
    [shuffled[i], shuffled[j]] = [shuffled[j], shuffled[i]];
  }
  
  return shuffled;
}

loadFeaturedProducts();

// Funci√≥n de notificaci√≥n
function showNotification(message, type = 'success') {
  let notification = document.getElementById('notification');
  if (!notification) {
    notification = document.createElement('div');
    notification.id = 'notification';
    notification.className = 'notification';
    document.body.appendChild(notification);
  }
  
  notification.textContent = message;
  notification.className = `notification ${type}`;
  notification.style.display = 'block';
  
  setTimeout(() => {
    notification.style.display = 'none';
  }, 3000);
}
</script>

<script>
// Mantener la etiqueta flotada si el campo tiene valor (login)
document.addEventListener('DOMContentLoaded', ()=>{
  const inputs = document.querySelectorAll('.field input, .field textarea, .field select');
  inputs.forEach(inp => {
    const toggle = ()=>{
      const parent = inp.closest('.field');
      if(!parent) return;
      if(inp.value && inp.value.trim() !== '') parent.classList.add('filled'); else parent.classList.remove('filled');
    };
    // Inicializar estado (por ejemplo, si hay valor en localStorage o autocompletado del navegador)
    toggle();
    inp.addEventListener('input', toggle);
    inp.addEventListener('change', toggle);
    // Tambi√©n manejar focus para animaci√≥n inmediata
    inp.addEventListener('focus', ()=>{
      const parent = inp.closest('.field'); if(parent) parent.classList.add('focused');
    });
    inp.addEventListener('blur', ()=>{
      const parent = inp.closest('.field'); if(parent) parent.classList.remove('focused');
    });
  });
});
</script>

<!-- Footer -->
<footer class="footer">
  <div class="footer-container">
    <div class="footer-column">
      <h4>Nosotros</h4>
      <a href="#">¬øQui√©nes Somos?</a>
      <a href="#">Sucursales</a>
      <a href="#">Contacto</a>
      <a href="#">Blog</a>
      <a href="productos.html">TODOS LOS PRODUCTOS</a>
      <a href="#">T√©rminos del servicio</a>
      <a href="#">Pol√≠tica de reembolso</a>
    </div>
    <div class="footer-column">
      <h4>Ayuda</h4>
      <a href="#">¬øC√≥mo comprar?</a>
      <a href="#">Env√≠os</a>
      <a href="#">Facturas</a>
      <a href="#">Preguntas frecuentes</a>
      <a href="#">T√©rminos y condiciones</a>
      <a href="#">Aviso de privacidad</a>
    </div>
    <div class="footer-column">
      <h4>Comprar</h4>
      <a href="productos.html">Descuentos</a>
      <a href="#">Formas de Pago</a>
      <a href="productos.html">Lo m√°s buscado</a>
      <a href="#">Mayoreo</a>
      <a href="productos.html">Productos nuevos</a>
    </div>
  </div>
</footer>

<!-- Script de Deslizadores -->
<script>
// Mapeo de pa√≠ses a banderas emoji
const paisFlags = {
  'M√©xico': 'üá≤üáΩ',
  'B√©lgica': 'üáßüá™',
  'Reino Unido': 'üá¨üáß',
  'Espa√±a': 'üá™üá∏',
  'USA': 'üá∫üá∏',
  'Estados Unidos': 'üá∫üá∏',
  'Francia': 'üá´üá∑',
  'Italia': 'üáÆüáπ',
  'Alemania': 'üá©üá™',
  'Jap√≥n': 'üáØüáµ',
  'China': 'üá®üá≥',
  'Brasil': 'üáßüá∑',
  'Argentina': 'üá¶üá∑',
  'Colombia': 'üá®üá¥',
  'Per√∫': 'üáµüá™',
  'Chile': 'üá®üá±'
};

// Cargar deslizadores de pa√≠ses y marcas
async function loadSliders() {
  try {
    const res = await fetch('/.netlify/functions/getProductos', { method: 'POST' });
    const data = await res.json();
    
    if (data.success) {
      const paises = [...new Set(data.products.map(p => p.pais).filter(p => p))];
      const marcas = [...new Set(data.products.map(p => p.marca).filter(m => m))];
      
      // Triplicar para efecto infinito sin cortes
      const paisesTriple = [...paises, ...paises, ...paises];
      const marcasTriple = [...marcas, ...marcas, ...marcas];
      
      const paisesHTML = paisesTriple.map(pais => `
        <div class="slider-item pais-item" onclick="window.location.href='productos.html?pais=${encodeURIComponent(pais)}'">
          <div class="slider-flag">${paisFlags[pais] || 'üåç'}</div>
          <div class="slider-text">${pais}</div>
        </div>
      `).join('');
      
      const marcasHTML = marcasTriple.map(marca => `
        <div class="slider-item marca-item" onclick="window.location.href='productos.html?marca=${encodeURIComponent(marca)}'">
          <div class="slider-text-marca">${marca}</div>
        </div>
      `).join('');
      
      const paisesSlider = document.getElementById('paisesSlider');
      const marcasSlider = document.getElementById('marcasSlider');
      
      if (paisesSlider) paisesSlider.innerHTML = paisesHTML;
      if (marcasSlider) marcasSlider.innerHTML = marcasHTML;
    }
  } catch (err) {
    console.error('Error al cargar deslizadores:', err);
  }
}

// Cargar al iniciar
loadSliders();

// Habilitar scroll con mouse drag en deslizadores
document.addEventListener('DOMContentLoaded', function() {
  const sliderContainers = document.querySelectorAll('.slider-container');
  
  sliderContainers.forEach(container => {
    let isDown = false;
    let startX;
    let scrollLeft;
    
    container.addEventListener('mousedown', (e) => {
      isDown = true;
      container.style.cursor = 'grabbing';
      startX = e.pageX - container.offsetLeft;
      scrollLeft = container.scrollLeft;
      const slider = container.querySelector('.slider');
      if (slider) slider.style.animationPlayState = 'paused';
    });
    
    container.addEventListener('mouseleave', () => {
      isDown = false;
      container.style.cursor = 'grab';
      const slider = container.querySelector('.slider');
      if (slider) slider.style.animationPlayState = 'running';
    });
    
    container.addEventListener('mouseup', () => {
      isDown = false;
      container.style.cursor = 'grab';
      const slider = container.querySelector('.slider');
      if (slider) slider.style.animationPlayState = 'running';
    });
    
    container.addEventListener('mousemove', (e) => {
      if (!isDown) return;
      e.preventDefault();
      const x = e.pageX - container.offsetLeft;
      const walk = (x - startX) * 2;
      container.scrollLeft = scrollLeft - walk;
    });
    
    // Touch support
    container.addEventListener('touchstart', () => {
      const slider = container.querySelector('.slider');
      if (slider) slider.style.animationPlayState = 'paused';
    });
    
    container.addEventListener('touchend', () => {
      const slider = container.querySelector('.slider');
      if (slider) slider.style.animationPlayState = 'running';
    });
  });
});
</script>

<!-- Script de Cookies -->
<script src="cookies.js"></script>

</body>
</html>

